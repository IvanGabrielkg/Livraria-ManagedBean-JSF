<ui:composition template="template.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core">

    <ui:define name="titulo">Carrinho de Compras</ui:define>

    <ui:define name="conteudo">
        <h:form id="formCarrinho">
            <h2 style="color:#3949AB;">ðŸ›’ Meu Carrinho</h2>

            <p:messages autoUpdate="true" closable="true" />

            <!-- Caso o carrinho esteja vazio -->
            <h:panelGroup rendered="#{empty lojaBean.carrinho}">
                <h3 style="text-align:center; color:gray; margin-top: 40px;">
                    Seu carrinho estÃ¡ vazio...
                </h3>
                <div style="text-align:center; margin-top:20px;">
                    <p:commandButton value="Voltar Ã  loja"
                                     icon="pi pi-arrow-left"
                                     action="loja.xhtml?faces-redirect=true"
                                     styleClass="ui-button-secondary" />
                </div>
            </h:panelGroup>

            <!-- Caso tenha itens -->
            <h:panelGroup rendered="#{not empty lojaBean.carrinho}">
                <p:dataTable value="#{lojaBean.carrinho}" var="livro" style="margin-top:20px;">
                    <p:column headerText="Capa" style="text-align:center;">
                        <h:graphicImage value="#{livro.imagem}" width="60" height="90" />
                    </p:column>

                    <p:column headerText="TÃ­tulo">
                        <h:outputText value="#{livro.nome}" />
                    </p:column>

                    <p:column headerText="Autor">
                        <h:outputText value="#{livro.autor}" />
                    </p:column>

                    <p:column headerText="PreÃ§o (R$)">
                        <h:outputText value="#{livro.preco}">
                            <f:convertNumber type="number" maxFractionDigits="2" minFractionDigits="2" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="AÃ§Ãµes" style="text-align:center;">

                        <p:commandButton icon="pi pi-times"
                                         title="Remover"
                                         actionListener="#{lojaBean.removerDoCarrinho(livro)}"
                                         update="@form"
                                         style="background-color:#E53935; border:none;" />
                    </p:column>
                </p:dataTable>

                <h3 style="text-align:right; margin-top:20px;">
                    Total:
                    <h:outputText value="#{lojaBean.totalCarrinho}">
                        <f:convertNumber type="number" maxFractionDigits="2" minFractionDigits="2" />
                    </h:outputText>
                </h3>

                <div style="text-align:right; margin-top:20px;">
                    <p:commandButton value="Finalizar Compra" 
                                     icon="pi pi-check"
                                     action="#{lojaBean.finalizarCompra}"
                                     update=":dialogCompra"
                                     oncomplete="PF('compraDialog').show()" />

                    <p:spacer width="8"/>

                    <p:commandButton value="ðŸ’– Ver Wishlist"
                                     icon="pi pi-heart"
                                     action="#{lojaBean.verWishlist}"
                                     styleClass="ui-button-secondary" />
                </div>
            </h:panelGroup>
        </h:form>

        <!-- Pop-up fora do form -->
        <!-- Pop-up -->
<p:dialog header="Compra ConcluÃ­da"
          widgetVar="compraDialog"
          modal="true"
          closable="true"
          resizable="false"
          id="dialogCompra"
          style="text-align:center;">
    <h3>âœ… Compra finalizada com sucesso!</h3>
    <h4>Livros comprados:</h4>

    <ui:repeat value="#{lojaBean.carrinho}" var="livro">
        <h:outputText value="#{livro.nome}" />
        <br />
    </ui:repeat>
</p:dialog>

    </ui:define>
</ui:composition>
